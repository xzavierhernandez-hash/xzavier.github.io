<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DemodHub – Proxy + AI + Rooms</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --bg:#0d0d1a;
      --panel:#151522;
      --glow:#00f2ff;
      --pink:#ff00e6;
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    body{background:var(--bg);color:#fff;overflow-x:hidden}
    header{display:flex;align-items:center;justify-content:space-between;padding:1rem 2rem;background:var(--panel);border-bottom:1px solid var(--glow);box-shadow:0 0 15px var(--glow)}
    h1{font-size:1.6rem;background:linear-gradient(90deg,var(--glow),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    nav{display:flex;gap:1rem}
    nav button{background:transparent;border:1px solid var(--glow);color:var(--glow);padding:.5rem 1rem;border-radius:20px;cursor:pointer;transition:.3s}
    nav button:hover{background:var(--glow);color:#000;box-shadow:0 0 10px var(--glow)}
    main{display:flex;height:calc(100vh - 64px)}
    .pane{width:50%;padding:1.5rem;display:flex;flex-direction:column;gap:1rem}
    .pane h2{margin-bottom:.5rem;font-weight:600}
    .glass{background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:1rem;backdrop-filter:blur(6px)}
    input,textarea{width:100%;padding:.75rem 1rem;border-radius:8px;border:1px solid rgba(255,255,255,.15);background:rgba(0,0,0,.25);color:#fff;outline:none;transition:border .2s}
    input:focus,textarea:focus{border-color:var(--glow)}
    iframe{width:100%;height:100%;border:none;border-radius:8px}
    #chatBox{flex:1;overflow-y:auto;padding:.5rem;font-size:.9rem}
    .msg{margin:.25rem 0}
  </style>
</head>
<body>
<header>
  <h1>DemodHub</h1>
  <nav>
    <button onclick="enterProxy()">Browse</button>
    <button onclick="toggleAi()">AI Chat</button>
    <button onclick="createRoom()">New Room</button>
  </nav>
</header>

<main>
  <!-- Left: Proxy pane -->
  <section class="pane">
    <h2>Built-in Proxy</h2>
    <div class="glass">
      <input id="urlIn" placeholder="https:// ..." value="https://example.org">
      <button onclick="loadSite()" style="margin-top:.5rem;width:100%">Go</button>
    </div>
    <div class="glass" style="flex:1;margin-top:1rem">
      <iframe id="proxyFrame" src=""></iframe>
    </div>
  </section>

  <!-- Right: AI + Chat pane -->
  <section class="pane">
    <h2>AI & Room Chat</h2>
    <div class="glass" style="flex:1;display:flex;flex-direction:column">
      <div id="chatBox"></div>
      <textarea id="msgIn" rows="2" placeholder="message / ask AI anything"></textarea>
      <button onclick="sendMsg()">Send</button>
    </div>
  </section>
</main>

<script>
/* ---------- proxy ---------- */
function loadSite(){
  const u=document.getElementById('urlIn').value.trim();
  if(!u.startsWith('http')){alert('Needs http(s)');return}
  document.getElementById('proxyFrame').src='https://api.allorigins.win/raw?url='+encodeURIComponent(u);
}
function enterProxy(){
  const u=prompt('Enter URL to unblock:','https://www.example.com');
  if(u){document.getElementById('urlIn').value=u; loadSite()}
}

/* ---------- AI ---------- */
let aiOn=false;
function toggleAi(){
  aiOn=!aiOn;
  addMsg('AI assistant '+(aiOn?'joined':'left'))
}
function askAi(prompt){
  return fetch('https://api.openai.com/v1/chat/completions',{
    method:'POST',
    headers:{'Content-Type':'application/json','Authorization':'Bearer sk-YOUR-OPENAI-KEY'},
    body:JSON.stringify({model:'gpt-3.5-turbo',messages:[{role:'user',content:prompt}]})
  }).then(r=>r.json()).then(d=>d.choices[0].message.content).catch(()=>'AI offline')
}

/* ---------- chat / rooms ---------- */
const ROOM=location.hash.slice(1)||'lobby';
let ws;
function addMsg(text,who='system'){
  const box=document.getElementById('chatBox');
  const div=document.createElement('div');div.className='msg';div.textContent=`[${who}] ${text}`;box.appendChild(div);box.scrollTop=box.scrollHeight
}
function createRoom(){
  const r=prompt('Room name:',Date.now().toString(36));
  if(r){location.hash=r;location.reload()}
}
function sendMsg(){
  const txt=document.getElementById('msgIn').value.trim();if(!txt)return;
  addMsg(txt,'you');document.getElementById('msgIn').value='';
  if(aiOn){askAi(txt).then(res=>addMsg(res,'AI'))}
  if(ws&&ws.readyState===1){ws.send(JSON.stringify({room:ROOM,msg:txt}))}
}
/* simple websocket relay – replace wss:// with your own server when ready */
ws=new WebSocket('wss://demos.yjs.dev/ws');ws.onopen=()=>ws.send(JSON.stringify({join:ROOM}));
ws.onmessage=e=>{const d=JSON.parse(e.data);if(d.room===ROOM&&d.user!==who){addMsg(d.msg,d.user)}};
ws.onclose=()=>addMsg('(chat relay disconnected)');

/* starter demo */
window.onload=()=>{addMsg(`Welcome to room ${ROOM}`);if(aiOn)addMsg('AI is on – ask anything')};
</script>
</body>
</html>
